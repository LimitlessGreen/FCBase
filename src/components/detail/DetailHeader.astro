---
import { compareToggleInlineScript } from "@/components/cards/compare-toggle-inline-script";

interface Props {
  title: string;
  subtitle?: string;
  description?: string;
  compareId?: string;
  compareType?: 'controller' | 'transmitter';
}

const { title, subtitle, description, compareId, compareType = 'controller' }: Props = Astro.props;
const hasBadges = Astro.slots.has('badges');
const hasDescription = Boolean(description) || Astro.slots.has('description');
const compareAriaLabel =
  compareType === 'transmitter'
    ? 'Add transmitter to comparison'
    : 'Add controller to comparison';
const compareEventName = 'fcbase:compare-change';
const storageKey = `fcbase:compare:${compareType}`;
const legacyKeys = JSON.stringify(compareType === 'controller' ? ['fcbase:compare'] : []);
---

<div class="mb-6">
  <div class="flex flex-col gap-3 sm:flex-row sm:items-start sm:justify-between">
    <div>
      <h1 class="text-3xl font-bold tracking-tight mb-1">{title}</h1>
      {subtitle && <p class="text-base text-muted-foreground">{subtitle}</p>}
    </div>
    <div class="flex flex-col gap-2 sm:items-end">
      {compareId && (
        <div class="sticky top-24 z-10 flex items-center gap-2 rounded-full border border-primary/15 bg-background/90 px-3 py-1.5 shadow-xs backdrop-blur supports-[backdrop-filter]:backdrop-blur-sm">
          <input
            id={`compare-toggle-${compareId}`}
            type="checkbox"
            class="h-4 w-4 rounded-sm border border-primary/15 text-primary focus-visible:outline-hidden focus-visible:ring-2 focus-visible:ring-primary/40"
            data-compare-toggle={compareId}
            data-compare-type={compareType}
            aria-label={compareAriaLabel}
          />
          <label
            for={`compare-toggle-${compareId}`}
            class="text-xs font-semibold uppercase tracking-wide text-muted-foreground"
          >
            Compare
          </label>
        </div>
      )}
      {hasBadges && (
        <div class="flex flex-wrap gap-1.5 sm:justify-end">
          <slot name="badges" />
        </div>
      )}
    </div>
  </div>
  {hasDescription && (
    <div class="mt-3 space-y-2 text-sm leading-relaxed text-muted-foreground">
      {description && <p>{description}</p>}
      <slot name="description" />
    </div>
  )}
</div>

{compareId && (
  <script
    is:inline
    set:html={compareToggleInlineScript}
    data-compare-id={compareId}
    data-compare-type={compareType}
    data-compare-storage-key={storageKey}
    data-compare-event-name={compareEventName}
    data-compare-legacy-keys={legacyKeys}
  />
)}
