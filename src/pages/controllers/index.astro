---
import { getCollection } from 'astro:content';
import MainLayout from '@/layouts/MainLayout.astro';
import ControllerSearch from '@/components/search/ControllerSearch';
import { getBasePath } from '@/lib/paths';

const controllers = await getCollection('controllers');
const totalControllers = controllers.length;
const basePath = getBasePath();
---

<MainLayout
  title="Flight Controllers - FCBase"
  description="Browse all flight controllers in the FCBase database. Compare specs, firmware support, and find the perfect board for your project."
  editPath="src/pages/controllers/index.astro"
>
    <div class="container py-8">
      <!-- Header -->
      <div class="mb-8">
        <nav class="mb-4 flex items-center gap-2 text-sm text-muted-foreground">
          <a href={`${basePath}/`} class="hover:text-foreground transition-colors">Home</a>
          <span>/</span>
          <span class="text-foreground">Controllers</span>
        </nav>
        
        <h1 class="text-4xl font-bold tracking-tight mb-3">Flight Controllers</h1>
        <p class="text-lg text-muted-foreground">
          Browse {totalControllers} flight controllers from various manufacturers
        </p>
      </div>

      <!-- Search & Filters -->
      <div class="mb-10 space-y-6">
        <div class="flex flex-col gap-2 text-center">
          <h2 class="text-2xl font-semibold tracking-tight md:text-3xl">Find your flight controller</h2>
          <p class="text-base text-muted-foreground md:text-lg">
            Pagefind provides instant search with MCU, mounting, CAN, MicroSD, and lifecycle facets generated at build-time.
          </p>
        </div>
        <ControllerSearch client:load totalControllers={totalControllers} />
      </div>

      <noscript>
        <div class="rounded-lg border border-dashed bg-muted/20 p-6 text-sm text-muted-foreground">
          <p class="font-medium text-foreground">Interactive search requires JavaScript.</p>
          <p>
            Enable JavaScript or browse individual controller pages from the sitemap to explore the full FCBase catalogue.
          </p>
        </div>
      </noscript>
    </div>
</MainLayout>
