---
import BaseLayout from '@/layouts/BaseLayout.astro';
import MainLayout from '@/layouts/MainLayout.astro';
import SiteSearch from '@/components/search/SiteSearch';
import faviconUrl from '@/assets/favicon.svg?url';

const basePath = import.meta.env.BASE_URL.replace(/\/$/, '');
const pageTitle = 'Search FCBase - Flight Controller & Component Database';
const pageDescription = 'Search flight controllers, MCUs, sensors, firmware, and manufacturers across the FCBase knowledge base using a static Pagefind index.';
const canonicalUrl = Astro.site
  ? new URL(`${basePath}/search`.replace(/^\/+/, ''), Astro.site).toString()
  : `${basePath}/search`;
const siteOrigin = Astro.site
  ? new URL(basePath || '/', Astro.site).toString().replace(/\/$/, '')
  : `https://limitlessgreen.github.io${basePath}`;
const searchTarget = `${siteOrigin}/search?q={search_term_string}`;
const resolvedFaviconPath = faviconUrl.startsWith('/') ? faviconUrl : `/${faviconUrl}`;
const ogImage = `${siteOrigin}${resolvedFaviconPath}`;
const searchJsonLd = JSON.stringify(
  {
    '@context': 'https://schema.org',
    '@type': 'WebSite',
    url: siteOrigin,
    potentialAction: {
      '@type': 'SearchAction',
      target: searchTarget,
      'query-input': 'required name=search_term_string',
    },
  },
  null,
  2
);
---

<BaseLayout title={pageTitle} description={pageDescription}>
  <MainLayout editPath="src/pages/search/index.astro">
    <Fragment slot="head">
      <link rel="canonical" href={canonicalUrl} />
      <meta property="og:title" content={pageTitle} />
      <meta property="og:description" content={pageDescription} />
      <meta property="og:type" content="website" />
      <meta property="og:url" content={canonicalUrl} />
      <meta property="og:image" content={ogImage} />
      <meta property="og:image:type" content="image/svg+xml" />
      <meta name="twitter:card" content="summary" />
      <meta name="twitter:title" content={pageTitle} />
      <meta name="twitter:description" content={pageDescription} />
      <meta name="twitter:image" content={ogImage} />
      <script type="application/ld+json" is:inline>{searchJsonLd}</script>
    </Fragment>

    <div class="container py-8">
      <nav class="mb-6 flex items-center gap-2 text-sm text-muted-foreground">
        <a href={`${basePath}/`} class="transition-colors hover:text-foreground">Home</a>
        <span>/</span>
        <span class="text-foreground">Search</span>
      </nav>

      <div class="mb-8 space-y-3">
        <h1 class="text-4xl font-bold tracking-tight">Search FCBase</h1>
        <p class="text-base text-muted-foreground md:text-lg">
          Query the entire FCBase catalogue with Pagefind. Results stay static, instant, and filterable even on GitHub Pages deployments.
        </p>
      </div>

      <SiteSearch client:load />
    </div>
  </MainLayout>
</BaseLayout>
